<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã²ã‚‰ãŒãªãƒ»ã‹ãŸã‹ãª ã‚¯ã‚¤ã‚º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@400;500&family=M+PLUS_Rounded+1c:wght@400;700&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #fff9db;
        }
        .font-kiwi {
            font-family: 'Kiwi Maru', serif;
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 transition-colors duration-500" id="body-bg">

    <div id="app-container" class="w-full max-w-md bg-white rounded-3xl shadow-xl overflow-hidden border-4 border-yellow-400 transition-all duration-500 relative">
        <!-- Header -->
        <div id="header" class="bg-yellow-400 p-6 text-gray-800 text-center transition-colors duration-500">
            <div id="level-badge" class="inline-block bg-white px-3 py-1 rounded-full text-xs font-bold mb-2 shadow-sm text-yellow-600">
                ãƒ¬ãƒ™ãƒ« 1ï¼šãµã¤ã†
            </div>
            <h1 id="header-title" class="text-2xl font-bold font-kiwi">
                ã²ã‚‰ãŒãªãƒ»ã‹ãŸã‹ãª ã‚¯ã‚¤ã‚º
            </h1>
            <p id="header-subtitle" class="text-sm font-bold opacity-80">ã©ã£ã¡ã§ ã‹ãã®ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ</p>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="p-6 text-center">
            <div class="mb-6">
                <span class="text-7xl" id="start-emoji">âœï¸</span>
            </div>
            
            <!-- ã“ã‚Œã¾ã§ã®ãã‚ã -->
            <div id="history-section" class="mb-8 p-5 bg-orange-50 rounded-3xl border-2 border-orange-200 text-left shadow-inner">
                <h3 class="text-lg font-bold text-orange-700 mb-4 flex items-center gap-2">
                    <span>ğŸ…</span> ã“ã‚Œã¾ã§ã® ãã‚ã
                </h3>
                <div id="history-list" class="grid grid-cols-1 gap-3">
                    <!-- JSã§æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                </div>
                <button onclick="resetRecords()" class="mt-4 text-[10px] text-gray-400 underline w-full text-center">ãã‚ãã‚’ ãƒªã‚»ãƒƒãƒˆã™ã‚‹</button>
            </div>

            <h2 class="text-xl font-bold mb-4 text-gray-700">ã˜ã‚…ã‚“ã³ã¯ ã„ã„ã‹ãªï¼Ÿ</h2>
            <div id="start-buttons" class="space-y-3">
                <button onclick="startQuiz(1)" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-5 rounded-2xl transition transform active:scale-95 shadow-lg text-2xl">
                    ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                </button>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="p-6 hidden">
            <div class="flex justify-between items-center mb-6 text-sm font-bold text-gray-500">
                <span id="progress-text">ã ã„ 1 ã‚‚ã‚“ / 10</span>
                <span id="score-text">ã¦ã‚“ã™ã†: 0</span>
            </div>

            <div class="mb-8 text-center">
                <p id="question-text" class="text-lg text-gray-600 mb-4 font-bold"></p>
                <div id="main-word" class="text-7xl font-bold text-gray-800 font-kiwi py-10 bg-yellow-50 rounded-2xl border-4 border-dotted border-yellow-200"></div>
            </div>

            <div id="options-container" class="grid grid-cols-1 gap-4"></div>

            <div id="feedback" class="mt-6 p-5 rounded-2xl hidden text-center border-2">
                <p id="feedback-message" class="font-bold text-2xl mb-2"></p>
                <p id="explanation" class="text-base text-gray-700 leading-relaxed"></p>
                <button id="next-btn" onclick="nextQuestion()" class="mt-6 bg-gray-800 text-white px-10 py-3 rounded-full text-lg font-bold hover:bg-gray-700 transition active:scale-95">
                    ã¤ãã¸ â†’
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="p-8 text-center hidden">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">ãŠã‚ã‚Šï¼</h2>
            <div class="text-7xl mb-6" id="result-emoji">ğŸ†</div>
            <p class="text-xl mb-2">ã‚ãªãŸã® ã¦ã‚“ã™ã†</p>
            <div class="text-6xl font-bold text-orange-500 mb-8" id="final-score">0 / 10</div>
            
            <div id="result-actions" class="space-y-4">
                <button id="levelup-btn-result" onclick="goToNextLevel()" class="hidden w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-5 rounded-2xl transition transform active:scale-95 shadow-lg text-xl">
                    ğŸš€ ã¤ãã® ãƒ¬ãƒ™ãƒ«ã¸ï¼
                </button>
                <button onclick="backToTitle()" class="w-full bg-yellow-400 hover:bg-yellow-500 text-gray-800 font-bold py-5 rounded-2xl transition transform active:scale-95 shadow-lg text-xl">
                    ã‚¿ã‚¤ãƒˆãƒ«ã« ã‚‚ã©ã‚‹
                </button>
            </div>
        </div>

        <!-- Celebration Popup -->
        <div id="celebration-overlay" class="absolute inset-0 bg-black/40 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-3xl p-8 m-4 shadow-2xl text-center animate-pop border-4 border-yellow-400 max-w-[90%]">
                <div class="text-6xl mb-4" id="celeb-emoji">ğŸ‰</div>
                <h3 id="celeb-title" class="text-2xl font-bold text-orange-600 mb-2">ã™ã”ãƒ¼ã„ï¼ï¼</h3>
                <p id="celeb-message" class="text-gray-700 font-bold mb-6">ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢ ãŠã‚ã§ã¨ã†ï¼</p>
                
                <div class="flex flex-col gap-3">
                    <button id="celeb-next-level-btn" onclick="goToNextLevelFromPop()" class="hidden bg-blue-500 text-white font-bold px-8 py-4 rounded-2xl shadow-lg hover:bg-blue-600 transition text-lg active:scale-95">
                        ğŸš€ ã¤ãã®ãƒ¬ãƒ™ãƒ«ã« ã™ã™ã‚€ï¼
                    </button>
                    <button onclick="closeCelebration()" class="bg-orange-500 text-white font-bold px-8 py-3 rounded-full shadow-lg hover:bg-orange-600 transition active:scale-95">
                        ã‚„ã£ãŸã­ï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'hiragana_katakana_quiz_scores';
        let userRecords = { 1: 0, 2: 0, 3: 0 };

        // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¨ç”»é¢ã®æ›´æ–°ã‚’ã‚»ãƒƒãƒˆã§è¡Œã†
        function syncRecordsWithUI() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                userRecords = JSON.parse(saved);
            }
            updateHistoryUI();
        }

        function updateHistoryUI() {
            const list = document.getElementById('history-list');
            if(!list) return;
            const levelNames = { 1: "ãµã¤ã†", 2: "ã‚€ãšã‹ã—ã„", 3: "ã¡ã‚‡ã†ã‚€ãš" };
            const levelColors = { 1: "bg-yellow-100 text-yellow-800", 2: "bg-blue-100 text-blue-800", 3: "bg-red-100 text-red-800" };
            
            list.innerHTML = [1, 2, 3].map(lv => {
                const score = userRecords[lv] || 0;
                return `
                    <div class="flex items-center justify-between p-3 rounded-2xl bg-white shadow-sm border border-orange-100">
                        <div class="flex items-center gap-3">
                            <span class="w-8 h-8 flex items-center justify-center rounded-full font-bold ${levelColors[lv]} text-sm">${lv}</span>
                            <span class="font-bold text-gray-700">${levelNames[lv]}</span>
                        </div>
                        <span class="text-2xl font-bold ${score > 0 ? 'text-orange-500' : 'text-gray-300'}">${score}<span class="text-sm text-gray-400"> / 10</span></span>
                    </div>`;
            }).join('');
        }

        function saveCurrentScore(level, score) {
            const currentBest = userRecords[level] || 0;
            if (score > currentBest) {
                userRecords[level] = score;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(userRecords));
                // ä¿å­˜ã—ãŸã‚‰ã™ãã«UIã‚‚æ›´æ–°
                updateHistoryUI();
            }
        }

        window.resetRecords = function() {
            if(confirm("ãã‚ãã‚’ ãœã‚“ã¶ ã‘ã—ã¦ã‚‚ ã„ã„ã§ã™ã‹ï¼Ÿ")) {
                userRecords = { 1: 0, 2: 0, 3: 0 };
                localStorage.removeItem(STORAGE_KEY);
                updateHistoryUI();
            }
        };

        const quizLevels = {
            1: [
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸ", options: ["ã‚Šã‚“ã”", "ãƒªãƒ³ã‚´"], correct: 0, explanation: "ã«ã»ã‚“ã® ãŸã¹ã‚‚ã®ã¯ã€ã²ã‚‰ãŒãªã§ ã‹ãã‚ˆã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸ’", options: ["ã‚‰ã‚“ã©ã›ã‚‹", "ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«"], correct: 1, explanation: "ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«ã¯ ãŒã„ã“ãã® ã“ã¨ã°ã ã‹ã‚‰ ã‹ãŸã‹ãªã ã‚ˆã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸ¦", options: ["ããµã¨ãã‚Šãƒ¼ã‚€", "ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ "], correct: 1, explanation: "ã‚½ãƒ•ãƒˆã‚¯ãƒªãƒ¼ãƒ ã¯ ãŒã„ã“ãã® ãŸã¹ã‚‚ã®ã ã­ã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸ£", options: ["ãŠã™ã—", "ã‚ªã‚¹ã‚·"], correct: 0, explanation: "ãŠã™ã—ã¯ ã«ã»ã‚“ã® ãŸã¹ã‚‚ã®ã ã‹ã‚‰ã€ã²ã‚‰ãŒãªã ã­ã€‚" },
                { q: "ã­ã“ã® ãªãã”ãˆã¯ï¼Ÿ", word: "ğŸˆ", options: ["ã«ã‚ƒãƒ¼ã«ã‚ƒãƒ¼", "ãƒ‹ãƒ£ãƒ¼ãƒ‹ãƒ£ãƒ¼"], correct: 1, explanation: "ãªãã”ãˆã¯ ã‹ãŸã‹ãªã§ ã‹ãã¨ æ­£è§£ã ã‚ˆã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸ¹", options: ["ã´ã‚ã®", "ãƒ”ã‚¢ãƒ"], correct: 1, explanation: "ãƒ”ã‚¢ãƒã¯ ãŒã„ã“ãã® ãŒã£ãã ã‹ã‚‰ ã‹ãŸã‹ãªã ã­ã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸŒ¸", options: ["ã•ãã‚‰", "ã‚µã‚¯ãƒ©"], correct: 0, explanation: "ã«ã»ã‚“ã® ã¯ãªã¯ ã²ã‚‰ãŒãªã§ ã‹ã“ã†ã€‚" },
                { q: "ã‹ãˆã‚‹ã® ãªãã”ãˆã¯ï¼Ÿ", word: "ğŸ¸", options: ["ã’ã‚ã’ã‚", "ã‚²ãƒ­ã‚²ãƒ­"], correct: 1, explanation: "ãªãã”ãˆã‚„ ãŠã¨ã¯ ã‹ãŸã‹ãªã§ ã‹ãã‚ˆã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸŒ", options: ["ã°ãªãª", "ãƒãƒŠãƒŠ"], correct: 1, explanation: "ãƒãƒŠãƒŠã¯ ãŒã„ã“ãã® ãã ã‚‚ã®ã ã­ã€‚" },
                { q: "ã“ã‚Œã¯ ã©ã£ã¡ã‹ãªï¼Ÿ", word: "ğŸš—", options: ["ãã‚‹ã¾", "ã‚¯ãƒ«ãƒ"], correct: 0, explanation: "ã«ã»ã‚“ã® ã“ã¨ã°ã¯ ã²ã‚‰ãŒãªã ã‚ˆã€‚" }
            ],
            2: [
                { q: "ã®ã°ã™ ãŠã¨ã« ã¡ã‚…ã†ã„ï¼", word: "ğŸ«", options: ["ã¡ã‚‡ã“ã‚Œãƒ¼ã¨", "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ"], correct: 1, explanation: "ã‹ãŸã‹ãªã® ã®ã°ã™ ãŠã¨ã¯ã€Œãƒ¼ã€ã‚’ ã¤ã‹ã†ã‚ˆã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ³", options: ["ãŠã‚€ã‚Œã¤", "ã‚ªãƒ ãƒ¬ãƒ„"], correct: 1, explanation: "ã‚ªãƒ ãƒ¬ãƒ„ã¯ ãŒã„ã“ãã® ãŸã¹ã‚‚ã®ã ã‹ã‚‰ ã‹ãŸã‹ãªã ã‚ˆã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ¡", options: ["ã ã‚“ã”", "ãƒ€ãƒ³ã‚´"], correct: 0, explanation: "ã ã‚“ã”ã¯ ã«ã»ã‚“ã® ãŸã¹ã‚‚ã®ã€‚ã²ã‚‰ãŒãªãŒ æ­£è§£ã€‚" },
                { q: "ãŠã¦ã‚‰ã® ã‹ã­ã® ãŠã¨ã¯ï¼Ÿ", word: "ğŸ””", options: ["ã”ãƒ¼ã‚“", "ã‚´ãƒ¼ãƒ³"], correct: 1, explanation: "ã‚‚ã®ã® ãŠã¨ã¯ ã‹ãŸã‹ãªã§ ã‹ãã‚ˆã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ°", options: ["ã†ã•ã", "ã‚¦ã‚µã‚®"], correct: 0, explanation: "ã†ã•ãã¯ ã«ã»ã‚“ã® ã©ã†ã¶ã¤ã€‚ã²ã‚‰ãŒãªã§ ã‹ã“ã†ã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ", options: ["ã±ã‚“", "ãƒ‘ãƒ³"], correct: 1, explanation: "ãƒ‘ãƒ³ã¯ ãŒã„ã“ãã® ã“ã¨ã°ã ã‚ˆã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ½", options: ["ãˆã·ã‚ã‚“", "ã‚¨ãƒ—ãƒ­ãƒ³"], correct: 1, explanation: "ã‚¨ãƒ—ãƒ­ãƒ³ã¯ ãŒã„ã“ãã‹ã‚‰ ããŸ ã“ã¨ã°ã ã­ã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ—»", options: ["ãµã˜ã•ã‚“", "ãƒ•ã‚¸ã‚µãƒ³"], correct: 0, explanation: "ãµã˜ã•ã‚“ã¯ ã«ã»ã‚“ã® å±±ã€‚ã²ã‚‰ãŒãªã ã­ã€‚" },
                { q: "ã‚ã‚ãŒ ãµã‚‹ ãŠã¨ã¯ï¼Ÿ", word: "â˜”", options: ["ã–ãƒ¼ã–ãƒ¼", "ã‚¶ãƒ¼ã‚¶ãƒ¼"], correct: 1, explanation: "ã‚ã‚ã® ãŠã¨ã‚‚ ã‹ãŸã‹ãªã§ ã‹ãã‚ˆã€‚" },
                { q: "ã©ã£ã¡ãŒ ãŸã ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ¥›", options: ["ã¿ã‚‹ã", "ãƒŸãƒ«ã‚¯"], correct: 1, explanation: "ãƒŸãƒ«ã‚¯ã¯ ãŒã„ã“ãã® è¨€è‘‰ã ã‹ã‚‰ã‚«ã‚¿ã‚«ãƒŠã ã‚ˆã€‚" }
            ],
            3: [
                { q: "ãŒã„ã“ãã® å›½ã® ãªã¾ãˆï¼", word: "ğŸ‡®ğŸ‡³", options: ["ã„ã‚“ã©", "ã‚¤ãƒ³ãƒ‰"], correct: 1, explanation: "ã‚¤ãƒ³ãƒ‰ã¯ ãŒã„ã“ãã® å›½ã® ãªã¾ãˆã ã‹ã‚‰ ã‹ãŸã‹ãªãŒ æ­£è§£ï¼" },
                { q: "æ—¥æœ¬ã® ãªã¾ãˆã¯ï¼Ÿ", word: "ğŸ‡¯ğŸ‡µ", options: ["ã«ã£ã½ã‚“", "ãƒ‹ãƒƒãƒãƒ³"], correct: 0, explanation: "ã˜ã¶ã‚“ã® å›½ã® ãªã¾ãˆã¯ ã²ã‚‰ãŒãªã§ ã‹ãã‚ˆã€‚" },
                { q: "ãŒã„ã“ãã® å›½ã® ãªã¾ãˆï¼", word: "ğŸ‡ºğŸ‡¸", options: ["ã‚ã‚ã‚Šã‹", "ã‚¢ãƒ¡ãƒªã‚«"], correct: 1, explanation: "ãŒã„ã“ãã® å›½ã® ãªã¾ãˆã¯ ã‹ãŸã‹ãªã§ ã‹ã“ã†ã€‚" },
                { q: "ã©ã£ã¡ãŒ æ­£ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ¥‹", options: ["ã˜ã‚…ã†ã©ã†", "ã‚¸ãƒ¥ã‚¦ãƒ‰ã‚¦"], correct: 0, explanation: "ã˜ã‚…ã†ã©ã†ã¯ æ—¥æœ¬ã® ã‚¹ãƒãƒ¼ãƒ„ã ã‹ã‚‰ ã²ã‚‰ãŒãªã ã‚ˆã€‚" },
                { q: "ãŒã„ã“ãã® äººã® ãªã¾ãˆï¼", word: "ğŸ¼", options: ["ã‚‚ãƒ¼ã¤ã‚ã‚‹ã¨", "ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ"], correct: 1, explanation: "ãŒã„ã“ãã® äººã® ãªã¾ãˆã‚‚ ã‹ãŸã‹ãªã ã­ã€‚" },
                { q: "æ—¥æœ¬ã® ã¶ã‚“ã‹ï¼", word: "ğŸ‘˜", options: ["ãã‚‚ã®", "ã‚­ãƒ¢ãƒ"], correct: 0, explanation: "ãã‚‚ã®ã¯ æ—¥æœ¬ã® ãµãã€‚ã²ã‚‰ãŒãªãŒ æ­£è§£ã€‚" },
                { q: "ã¾ã˜ã‚Šã‚ã£ãŸ ã‹ãã‹ãŸï¼", word: "ğŸœ", options: ["ãƒ©ãƒ¼ã‚ãƒ³", "ãƒ©ãƒ¼ãƒ¡ãƒ³"], correct: 1, explanation: "ã‹ãŸã‹ãªã® ãªã‹ã« ã²ã‚‰ãŒãªã‚’ ã¾ãœãªã„ã‚ˆã†ã«ï¼" },
                { q: "æ—¥æœ¬ã® ãŠã¾ã¤ã‚Šï¼", word: "ğŸ¥", options: ["ãŸã„ã“", "ã‚¿ã‚¤ã‚³"], correct: 0, explanation: "ãŸã„ã“ã¯ æ—¥æœ¬ã® ãŒã£ãã€‚ã²ã‚‰ãŒãªã§ ã‹ã“ã†ã€‚" },
                { q: "ã©ã£ã¡ãŒ æ­£ã—ã„ã‹ãªï¼Ÿ", word: "ğŸ»", options: ["ã°ã„ãŠã‚Šã‚“", "ãƒã‚¤ã‚ªãƒªãƒ³"], correct: 1, explanation: "ãƒã‚¤ã‚ªãƒªãƒ³ã¯ ãŒã„ã“ãã®ãŒã£ãã ã‚ˆã€‚" },
                { q: "æ—¥æœ¬ã® ãã ã‚‚ã®ï¼", word: "ğŸŠ", options: ["ã¿ã‹ã‚“", "ãƒŸã‚«ãƒ³"], correct: 0, explanation: "ã¿ã‹ã‚“ã¯ æ—¥æœ¬ã® ãã ã‚‚ã®. ã²ã‚‰ãŒãªãŒ æ­£ã—ã„ã‚ˆã€‚" }
            ]
        };

        let currentLevel = 1;
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let canAnswer = true;

        window.startQuiz = function(level) {
            currentLevel = level;
            updateAppTheme(level);
            currentQuestions = [...quizLevels[level]].sort(() => 0.5 - Math.random()).slice(0, 10);
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            
            currentIndex = 0;
            score = 0;
            showQuestion();
        };

        window.backToTitle = function() {
            // ä»–ã®ç”»é¢ã‚’éš ã—ã¦ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¡¨ç¤º
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('levelup-btn-result').classList.add('hidden');
            
            // é‡è¦ï¼šã“ã“ã§æœ€æ–°ã®è¨˜éŒ²ã‚’åæ˜ ã•ã›ã‚‹
            syncRecordsWithUI();
            updateAppTheme(1);
        };

        function updateAppTheme(level) {
            const app = document.getElementById('app-container');
            const header = document.getElementById('header');
            const badge = document.getElementById('level-badge');
            const title = document.getElementById('header-title');
            if (level === 3) {
                app.style.borderColor = '#ef4444';
                header.className = "bg-red-600 p-6 text-white text-center";
                badge.innerText = "ãƒ¬ãƒ™ãƒ« 3ï¼šã•ã„ã”ã® ã—ã‚Œã‚“";
                badge.className = "inline-block bg-white px-3 py-1 rounded-full text-xs font-bold mb-2 shadow-sm text-red-600";
                title.innerText = "ğŸ”¥ ã¡ã‚‡ã†ã‚€ãšã‹ã—ã„ï¼";
            } else if (level === 2) {
                app.style.borderColor = '#42a5f5';
                header.className = "bg-blue-500 p-6 text-white text-center";
                badge.innerText = "ãƒ¬ãƒ™ãƒ« 2ï¼šã‚€ãšã‹ã—ã„";
                badge.className = "inline-block bg-white px-3 py-1 rounded-full text-xs font-bold mb-2 shadow-sm text-blue-600";
                title.innerText = "ğŸš€ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼";
            } else {
                app.style.borderColor = '#fbbf24';
                header.className = "bg-yellow-400 p-6 text-gray-800 text-center";
                badge.innerText = "ãƒ¬ãƒ™ãƒ« 1ï¼šãµã¤ã†";
                badge.className = "inline-block bg-white px-3 py-1 rounded-full text-xs font-bold mb-2 shadow-sm text-yellow-600";
                title.innerText = "ã²ã‚‰ãŒãªãƒ»ã‹ãŸã‹ãª ã‚¯ã‚¤ã‚º";
            }
        }

        function showQuestion() {
            const q = currentQuestions[currentIndex];
            canAnswer = true;
            document.getElementById('progress-text').innerText = `ã ã„ ${currentIndex + 1} ã‚‚ã‚“ / 10`;
            document.getElementById('score-text').innerText = `ã¦ã‚“ã™ã†: ${score}`;
            document.getElementById('question-text').innerText = q.q;
            document.getElementById('main-word').innerText = q.word;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full py-5 px-4 rounded-2xl border-4 border-gray-100 font-bold text-2xl hover:bg-gray-50 transition active:scale-95 bg-white shadow-sm text-gray-800";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(idx);
                container.appendChild(btn);
            });
            document.getElementById('feedback').classList.add('hidden');
        }

        window.checkAnswer = function(idx) {
            if (!canAnswer) return;
            canAnswer = false;
            const q = currentQuestions[currentIndex];
            const isCorrect = idx === q.correct;
            const feedback = document.getElementById('feedback');
            const options = document.getElementById('options-container').children;
            feedback.classList.remove('hidden');
            feedback.className = `mt-6 p-5 rounded-2xl text-center border-2 ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
            document.getElementById('feedback-message').innerText = isCorrect ? "â­•ï¸ ã›ã„ã‹ã„ï¼" : "âŒ ã–ã‚“ã­ã‚“ï¼";
            document.getElementById('feedback-message').className = `font-bold text-2xl mb-2 ${isCorrect ? 'text-green-600' : 'text-red-600'}`;
            if (isCorrect) score++;
            options[idx].classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
            options[q.correct].classList.add('border-green-500');
            document.getElementById('explanation').innerText = q.explanation;
            document.getElementById('score-text').innerText = `ã¦ã‚“ã™ã†: ${score}`;
        };

        window.nextQuestion = function() {
            currentIndex++;
            if (currentIndex < 10) showQuestion();
            else showResult();
        };

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score} / 10`;
            saveCurrentScore(currentLevel, score);
            if (score === 10 && currentLevel < 3) document.getElementById('levelup-btn-result').classList.remove('hidden');
            if (score >= 8) showCelebrationPopup();
        }

        function showCelebrationPopup() {
            const overlay = document.getElementById('celebration-overlay');
            overlay.classList.remove('hidden');
            if (score === 10) {
                document.getElementById('celeb-emoji').innerText = "ğŸ‘‘";
                document.getElementById('celeb-title').innerText = "âœ¨ ã‹ã‚“ãºãï¼ï¼ âœ¨";
                if (currentLevel < 3) document.getElementById('celeb-next-level-btn').classList.remove('hidden');
            }
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }

        window.closeCelebration = () => document.getElementById('celebration-overlay').classList.add('hidden');
        window.goToNextLevelFromPop = () => { closeCelebration(); goToNextLevel(); };
        window.goToNextLevel = () => { if (currentLevel < 3) startQuiz(currentLevel + 1); };

        // èµ·å‹•æ™‚
        window.onload = syncRecordsWithUI;
    </script>
</body>
</html>